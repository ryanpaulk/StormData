---
title: "Population and Economic Effects of Storm Damage"
author: "RP"
date: "3/1/2021"
output: html_document
---
``` {r, echo = FALSE, cache = TRUE, message = FALSE}
if(!file.exists("StormData.csv.bz2")){
download.file("https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2", "StormData.csv.bz2")
}

library(dplyr)
library(data.table)
library(ggplot2)
stormdata <- fread("StormData.csv.bz2")
```
```{r, echo = FALSE, message = FALSE}
library(dplyr)
library(data.table)
library(ggplot2)
```
## Data Processing for Question 1:

### Across the United States, which types of events  are most harmful with respect to population health?

```{r}
pophealth <- stormdata %>% select(EVTYPE, FATALITIES, INJURIES)
## Combine the columns and filter out the zeroes
harmed <- pophealth %>% select(EVTYPE, FATALITIES, INJURIES) %>% mutate(HARMED = FATALITIES + INJURIES) %>% filter(HARMED != 0)
## Aggregate totals by the event type
harmed <- aggregate(cbind(FATALITIES, INJURIES, HARMED) ~ EVTYPE, data = harmed, FUN = sum)
## Arrange by total harmed, then by most fatalities
harmed <- arrange(harmed, desc(HARMED, FATALITIES))
## Plot the top ten?
harmed10 <- harmed[1:10,]
harmed10

```

## Results for Question 1:

A bar graph showing the storm events that caused the top ten greatest about of
injury and death to the US population.
```{r plotting}
ggplot(harmed10, aes(x = EVTYPE, y = INJURIES + FATALITIES)) + geom_bar(position = "stack", stat = "identity", fill = "red") + labs(title = "Effect of Storms on Population Health", x = "Storm Type", y = "Number of Victims") + theme(axis.text.x=element_text(angle=33, hjust = 1))
```

## Data Processing for Question 2:

### Across the United States, which types of events have the greatest economic consequences?

```{r}
#Relevant columns are Property Damages and Crop Damages. 
#Both Damages have two columns: one with "value" and one an "exponent", where M = millions and K = thousands
economy <- stormdata %>% select(EVTYPE, PROPDMG, PROPDMGEXP, CROPDMG, CROPDMGEXP)
## Change letter suffixes in EXP to numeric multipliers of DMG
economy$CROPDMGEXP <- gsub("k", "1000", economy$CROPDMGEXP, ignore.case = TRUE)
economy$CROPDMGEXP <- gsub("m", "1000000", economy$CROPDMGEXP, ignore.case = TRUE)
economy$PROPDMGEXP <- gsub("k", "1000", economy$PROPDMGEXP, ignore.case = TRUE)
economy$PROPDMGEXP <- gsub("m", "1000000", economy$PROPDMGEXP, ignore.case = TRUE)
## Noticed some other modifiers while scrolling through the data...
## Find out what they are
table(economy$PROPDMGEXP)
##Make them disappear
##All weird ones are just changed to identity multiplier, "1"
economy$PROPDMGEXP <- gsub("h", "100", economy$PROPDMGEXP, ignore.case = TRUE)
economy$PROPDMGEXP <- gsub("b", "1000000000", economy$PROPDMGEXP, ignore.case = TRUE)
economy$PROPDMGEXP <- gsub("\\-|\\?|\\+|2|3|4|5|6|7|8|9", "1", economy$PROPDMGEXP, ignore.case = TRUE)
table(economy$CROPDMGEXP)
economy$CROPDMGEXP <- gsub("b", "1000000000", economy$CROPDMGEXP, ignore.case = TRUE)
economy$CROPDMGEXP <- gsub("\\?|2", "1", economy$CROPDMGEXP, ignore.case = TRUE)

economy$CROPDMGEXP <- as.numeric(economy$CROPDMGEXP)
economy$PROPDMGEXP <- as.numeric(economy$PROPDMGEXP)
```
``` {r}
##Combine the DMG and EXP columns

eco <- economy %>% mutate(PROP = PROPDMG * PROPDMGEXP, CROP = CROPDMG * CROPDMGEXP)
ecodmg <- aggregate(cbind(PROP, CROP) ~ EVTYPE, data = eco, FUN = sum)
ecodmg$TOTAL <- ecodmg$PROP + ecodmg$CROP
ecodmg <- arrange(ecodmg, desc(TOTAL))
ecodmg10 <- ecodmg[1:10,]
ecodmg10
```

## Results for Question 2

A bar graph displaying the extent of damage caused by the top ten storm types.
```{r}
dmg <- ggplot(ecodmg10, aes(EVTYPE, TOTAL))
dmg + geom_bar(stat = "identity", fill = "blue") + theme(axis.text.x=element_text(angle=33, hjust = 1)) + labs(title = "Total Economic Damage of Property and Crops", x= "Storm Type", y = "Economic Damage ($)")
```

## Synopsis:

According to the data, tornadoes cause the most total harm to people in the US,
as well as being the leading cause of injury and death by storm.

Floods, on the financial side, are the leading cause of economic damage, doing 
the most damage in regards to both property and crops.








